<script>
    App.checkout_document_list = {
        doc_list: [],
        checkout_doc_head: [],
        init: function () {
            App.title("Список проверок");
            App.checkout_document_list.focus();
        },
        check_storage: function () {
            var storage_checkout_entries = App.json(App.restore('checkout_entries'));
            var storage_log_list = App.json(App.restore('log_list'));
            if (storage_log_list != null && storage_checkout_entries != null) {
                App.checkout_document_list.checkout_entries.list = storage_checkout_entries;
                App.checkout_document_list.log = storage_log_list;
            } else {
                return true;
            }
        },
        focus: function () {
            App.title("Список проверок");
            App.checkout_document_list.doc_list=[];
            App.checkout_document_list.load();
        },
        load: function (offset) {
            if (offset === undefined) {
		offset = App.checkout_document_list.doc_list.length || 0;
	    }
            var name=$("#checkout_list_namefilter").val();
            var date=$("#checkout_list_datefilter").val();
            var filter=JSON.stringify({cstamp:date,checkout_name:name});
            App.flash('Список проверок: загрузка...');
            $.post('../Checkout/checkoutListFetch', {offset:offset, limit: 10,filter:filter}, function (resp) {
                var response = App.json(resp);
                if (response.length<5){
                    $("#checkout_button_load_more").hide();
                }
                App.checkout_document_list.doc_list = App.checkout_document_list.doc_list.concat(response);
                App.checkout_document_list.render();
                App.flash('Список проверок: ОК');
            });
        },
        reload:function(){
            App.checkout_document_list.doc_list=[];
            App.checkout_document_list.load(0);
        },
        render: function () {
            App.renderTpl("doc_list", {doc_list: App.checkout_document_list.doc_list});
        },
        open_document: function (node){
            var checkout_id = $(node).data('checkout_id');
	    location.hash = "#checkout_document.html#checkout_id=" + checkout_id;
        },
        create_document: function(){
            var checkout_name=prompt("Название нового списка проверки");
            if( !checkout_name ){
                return;
            }
            $.post("../Checkout/checkoutStockCreate",{parent_id:0,checkout_name:checkout_name},function(resp){
                App.checkout_document_list.reload();
            });
        }
    };
</script>    
<style>
    
</style>

<div class="ui blue segment">
    <form class="ui form">
        <h4 class="ui header">Фильтр</h4>
        <div class="two fields">
            <div class="field">
                <label>Фильтровать по названию</label>
                <div class="field">
                    <div class="ui left icon input">
                        <i class="file icon"></i>
                        <input name="name_filter" placeholder="Название" type="text" id="checkout_list_namefilter" onchange="App.checkout_document_list.doc_list=[];App.checkout_document_list.load(0);">
                    </div>
                </div>
            </div>
            <div class="field">
                <label>Фильтровать по дате</label>
                <div class="field">
                    <div class="ui left icon input">
                        <i class="calendar icon"></i>
                        <input name="date_filter" placeholder="Дата" type="date" id="checkout_list_datefilter" onchange="App.checkout_document_list.doc_list=[];App.checkout_document_list.load(0);">
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

    <div id="doc_list" class="covert">
        <div class="ui button" onclick="App.checkout_document_list.create_document()"><i class="ui plus icon"></i> Создать список проверки склада</div>
        <table class="ui unstackable selectable table">
            <thead> 
                <tr>
                    <th>Название</th>
                    <th style="width:200px">Дата</th>
                    <th style="width:50px">Статус</th>
                </tr>
            </thead>
            <tbody>
                <!--{{doc_list}}-->
                <tr class="doc_row" data-checkout_id="{{checkout_id}}" onclick="App.checkout_document_list.open_document(this)">
                    <td class="doc_name">{{checkout_name}}</td>
                    <td>{{cstamp_dmy}}</td>
                    <td class="doc_status">
                        {{if checkout_status|equals>not_checked}}
                        <i class="close red large icon"></i>
                        {{else}}
                            {{if checkout_status|equals>checked}}
                            <i class="check green large icon"></i>
                            {{else}}
                                {{if checkout_status|equals>checked_with_divergence}}
                                <div>
                                    <i class="large icons">
                                        <i class="check green icon"></i>
                                        <i class="bottom left corner plus green icon"></i>
                                        <i class="bottom right corner minus red icon"></i>
                                    </i>
                                </div>
                                {{else}}
                                    {{if checkout_status|equals>is_checking}}
                                        <i class="spinner blue loading large icon"></i>
                                    {{/if}}
                                {{/if}}
                            {{/if}}
                        {{/if}}
                    </td>
                </tr>
                <!--{{/doc_list}}-->
            </tbody>
        </table>
    </div>

<button id="checkout_button_load_more"  class="ui fluid button" onclick="App.checkout_document_list.load()">Показать еще...</button>
