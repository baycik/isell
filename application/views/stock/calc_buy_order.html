<script type="text/javascript">
    /*global App */
    App.page_stock_calc_buy_order = {
	parsed:true,
	init: function () {
	    this.node.window({
		title: 'Формирование заказа',
		width: 550,
                top:50,
		height: 'auto',
		shadow:false,
		onClose:function(){
                    delete App.page_stock_calc_buy_order;
		}
	    });
	    this.node.window('hcenter');
	    this.node.window('window').css('position','fixed');
	    App.handler.progress(function(status,pcomp){
                if( status==='passiveCompanySelected' ){
		    $("#page_stock_calc_buy_order_pcomp").val(pcomp.label);
                }
            });
            if( App.pcomp ){
                this.data.pcomp_name=App.pcomp.label||"Не выбран";
            }
            this.data.round_to='bpack';
            App.setupForm("#page_stock_calc_min_frm",this.data);
	},
	select_pcomp:function(){
	    App.user.pcompSelectionDialog();
	},
	submit:function(e){
	    e.preventDefault();
            this.data=App.collectForm("#page_stock_calc_min_frm");
	    if( !App.pcomp ){
		alert("Выберите поставщика");
		App.loadWindow('page/company/tree',{}).progress(function(status,comp){
		    if( status==='select' ){
			App.user.setPassiveCompany(comp);
		    }
		});
		return false;
	    }
	    this.handler.notify('submit',App.page_stock_calc_buy_order.data);
            this.node.window('close');
	}
    };
</script>
<form id="page_stock_calc_min_frm" onsubmit="App.page_stock_calc_buy_order.submit(event)">
    <img src="img/docnew.png" style="float:left" /> 
    <p style="padding: 5px">
    <big>Формирование заказа поставщику</big><br><br>
	Формула расчета заказа.<br>
	Заказ = Минимальный остаток - Текущий остаток;
    </p>
    <input id="page_stock_calc_buy_order_pcomp" name="pcomp_name" title="Поставщик" value="не выбран" readonly="readonly" />
    <button type="button" class="tiny_button" onclick="App.page_stock_calc_buy_order.select_pcomp()"><img src="img/settings.png"> Изменить</button>
    <select name="round_to" title="Округлять до">
        <option value="bpack">Большой упаковки</option>
        <option value="spack">Маленькой упаковки</option>
        <option value="piece">Не округлять</option>
    </select>
    <div style="text-align: center;margin-top: 25px;">
	<button type="submit"><img src="img/docnew.png" style="width:24px;height: 24px;"> Сформировать</button>
	<button type="button" onclick="App.page_stock_calc_buy_order.node.window('close')"><img src="img/close24.png" /> Закрыть</button>
    </div>
</form>